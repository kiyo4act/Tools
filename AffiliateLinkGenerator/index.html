<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0">
  <title>アフィリエイトリンク生成ツール</title>
  <meta name="version"
        content="1">
  <meta name="last-updated"
        content="2025-09-23">
  <meta name="description"
        content="EC サイトの商品URLを入力すると、アフィリエイトリンクに変換するツール。現在はAmazonに対応、将来的に楽天等も対応予定。">

  <script async
          src="https://www.googletagmanager.com/gtag/js?id=G-WWQTE7VWKG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-WWQTE7VWKG');
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 2rem;
      text-align: center;
    }

    .version-info {
      text-align: center;
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 20px;
    }

    .tool-description {
      background: #f0f4ff;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      color: #555;
      line-height: 1.6;
    }

    .platform-selector {
      margin: 20px 0;
      padding: 20px;
      background: #fafafa;
      border-radius: 10px;
    }

    .platform-label {
      display: block;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    select {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
      background: white;
      cursor: pointer;
      transition: border-color 0.3s;
    }

    select:focus {
      outline: none;
      border-color: #667eea;
    }

    .tag-settings {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .tag-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tag-input-label {
      font-size: 0.9rem;
      color: #555;
      white-space: nowrap;
    }

    .tag-input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 0.9rem;
    }

    .input-section {
      margin: 30px 0;
    }

    .input-label {
      display: block;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .url-input-group {
      display: flex;
      gap: 10px;
    }

    .url-input {
      flex: 1;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .url-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .convert-button {
      padding: 15px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .convert-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .convert-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .result-section {
      margin-top: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 10px;
      display: none;
    }

    .result-section.show {
      display: block;
    }

    .result-label {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .result-box {
      background: white;
      border: 2px solid #4CAF50;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      word-break: break-all;
      font-family: 'Courier New', monospace;
      font-size: 0.95rem;
    }

    .copy-button {
      width: 100%;
      padding: 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .copy-button:hover {
      background: #45a049;
    }

    .copy-button.copied {
      background: #2196F3;
    }

    .error-message {
      background: #fee;
      border-left: 4px solid #f44336;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      color: #c00;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .warning-message {
      background: #fff8e1;
      border-left: 4px solid #ff9800;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      color: #f57c00;
      display: none;
    }

    .warning-message.show {
      display: block;
    }

    .usage-section {
      margin-top: 40px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .usage-section h3 {
      color: #333;
      margin-bottom: 15px;
    }

    .usage-section ol {
      padding-left: 25px;
      line-height: 2;
      color: #555;
    }

    .usage-section li {
      margin-bottom: 10px;
    }

    .supported-urls {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
    }

    .supported-urls h4 {
      color: #333;
      margin-bottom: 10px;
      font-size: 0.95rem;
    }

    .supported-urls ul {
      padding-left: 20px;
      color: #666;
    }

    .supported-urls li {
      margin: 5px 0;
      font-size: 0.9rem;
    }

    .supported-urls code {
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
    }

    .history-section {
      margin-top: 30px;
      padding: 20px;
      background: #f5f5f5;
      border-radius: 10px;
    }

    .history-title {
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .clear-history {
      padding: 5px 10px;
      background: #ff5252;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .clear-history:hover {
      background: #ff1744;
    }

    .history-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .history-item {
      background: white;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .history-item:hover {
      background: #e8eaf6;
    }

    .history-item-url {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: #555;
    }

    .history-item-date {
      color: #999;
      font-size: 0.8rem;
      margin-left: 10px;
    }

    .footer-note {
      text-align: center;
      color: #999;
      font-size: 0.85rem;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e0e0e0;
    }

    @media (max-width: 600px) {
      .container {
        padding: 25px;
      }

      h1 {
        font-size: 1.5rem;
      }

      .url-input-group {
        flex-direction: column;
      }

      .convert-button {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>🔗 アフィリエイトリンク生成ツール</h1>
    <p class="version-info">最終更新: 2025年9月23日 (Ver. 1)</p>

    <div class="tool-description">
      ECサイトの商品URLを入力すると、アフィリエイトリンクに自動変換します。<br>
      現在はAmazonに対応しています。（将来的に楽天等も対応予定）
    </div>

    <div class="platform-selector">
      <label class="platform-label"
             for="platform-select">プラットフォームを選択:</label>
      <select id="platform-select">
        <option value="amazon">Amazon</option>
        <option value="rakuten"
                disabled>楽天（準備中）</option>
      </select>

      <div class="tag-settings">
        <div class="tag-input-group">
          <label class="tag-input-label"
                 for="affiliate-tag">アフィリエイトタグ:</label>
          <input type="text"
                 id="affiliate-tag"
                 class="tag-input"
                 value="konoe.studio-22"
                 placeholder="your-tag-22">
        </div>
      </div>
    </div>

    <div class="input-section">
      <label class="input-label"
             for="url-input">商品ページのURLを入力:</label>
      <div class="url-input-group">
        <input type="text"
               id="url-input"
               class="url-input"
               placeholder="https://www.amazon.co.jp/dp/B0FHCQF5YT">
        <button id="convert-button"
                class="convert-button">変換する</button>
      </div>
    </div>

    <div id="error-message"
         class="error-message"></div>
    <div id="warning-message"
         class="warning-message"></div>

    <div id="result-section"
         class="result-section">
      <div class="result-label">生成されたアフィリエイトリンク:</div>
      <div id="result-box"
           class="result-box"></div>
      <button id="copy-button"
              class="copy-button">リンクをコピー</button>
    </div>

    <div id="history-section"
         class="history-section"
         style="display: none;">
      <div class="history-title">
        <span>📝 変換履歴（最新10件）</span>
        <button id="clear-history"
                class="clear-history">履歴をクリア</button>
      </div>
      <div id="history-list"
           class="history-list"></div>
    </div>

    <div class="usage-section">
      <h3>📚 使い方</h3>
      <ol>
        <li><strong>プラットフォームを選択</strong>: 現在はAmazonのみ対応しています</li>
        <li><strong>アフィリエイトタグを設定</strong>: デフォルトで設定済みですが、変更可能です</li>
        <li><strong>商品URLを入力</strong>: Amazon商品ページのURLをコピー＆ペースト</li>
        <li><strong>変換ボタンをクリック</strong>: アフィリエイトリンクが自動生成されます</li>
        <li><strong>リンクをコピー</strong>: 生成されたリンクをワンクリックでコピー</li>
      </ol>

      <div class="supported-urls">
        <h4>✅ 対応しているAmazon URLパターン:</h4>
        <ul>
          <li>商品ページ: <code>https://www.amazon.co.jp/dp/B0XXXXXXXX</code></li>
          <li>商品ページ（長い形式）: <code>https://www.amazon.co.jp/商品名/dp/B0XXXXXXXX</code></li>
          <li>gp/product形式: <code>https://www.amazon.co.jp/gp/product/B0XXXXXXXX</code></li>
        </ul>
      </div>

      <div class="supported-urls"
           style="margin-top: 15px; background: #fff8e1;">
        <h4>⚠️ 短縮URL（amzn.to）について:</h4>
        <ul style="color: #f57c00;">
          <li>短縮URLは自動展開できません</li>
          <li>ブラウザで短縮URLを開き、展開されたURLをコピーしてください</li>
        </ul>
      </div>
    </div>

    <p class="footer-note">
      このツールはブラウザ内で動作し、入力データはサーバーに送信されません。<br>
      設定とURLはローカルストレージに保存されます。
    </p>
  </div>

  <script>
    // プラットフォーム設定（将来の拡張を考慮）
    const platforms = {
      amazon: {
        name: 'Amazon',
        enabled: true,
        defaultTag: 'konoe.studio-22',
        patterns: [
          /amazon\.co\.jp.*\/dp\/([A-Z0-9]{10})/i,
          /amazon\.co\.jp.*\/gp\/product\/([A-Z0-9]{10})/i
        ],
        shortUrlPattern: /amzn\.to\//i,
        generateLink: function (productId, tag) {
          return `https://www.amazon.co.jp/dp/${productId}?tag=${tag}&linkCode=ogi&th=1&psc=1`;
        }
      },
      rakuten: {
        name: '楽天',
        enabled: false,
        defaultTag: '',
        patterns: [],
        generateLink: null
      }
    };

    // DOM要素の取得
    const platformSelect = document.getElementById('platform-select');
    const affiliateTagInput = document.getElementById('affiliate-tag');
    const urlInput = document.getElementById('url-input');
    const convertButton = document.getElementById('convert-button');
    const errorMessage = document.getElementById('error-message');
    const warningMessage = document.getElementById('warning-message');
    const resultSection = document.getElementById('result-section');
    const resultBox = document.getElementById('result-box');
    const copyButton = document.getElementById('copy-button');
    const historySection = document.getElementById('history-section');
    const historyList = document.getElementById('history-list');
    const clearHistoryButton = document.getElementById('clear-history');

    // ローカルストレージのキー
    const STORAGE_KEYS = {
      affiliateTag: 'affiliate_tag',
      selectedPlatform: 'selected_platform',
      conversionHistory: 'conversion_history'
    };

    // 初期化
    function init() {
      // ローカルストレージから設定を復元
      const savedTag = localStorage.getItem(STORAGE_KEYS.affiliateTag);
      const savedPlatform = localStorage.getItem(STORAGE_KEYS.selectedPlatform);

      if (savedTag) {
        affiliateTagInput.value = savedTag;
      }

      if (savedPlatform && platforms[savedPlatform] && platforms[savedPlatform].enabled) {
        platformSelect.value = savedPlatform;
      }

      // 履歴を表示
      loadHistory();

      // イベントリスナーの設定
      platformSelect.addEventListener('change', handlePlatformChange);
      affiliateTagInput.addEventListener('input', handleTagChange);
      convertButton.addEventListener('click', handleConvert);
      copyButton.addEventListener('click', handleCopy);
      clearHistoryButton.addEventListener('click', clearHistory);

      // URLの入力でEnterキーを押したときも変換
      urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          handleConvert();
        }
      });
    }

    // プラットフォーム変更時の処理
    function handlePlatformChange() {
      const selectedPlatform = platformSelect.value;
      localStorage.setItem(STORAGE_KEYS.selectedPlatform, selectedPlatform);

      // プラットフォームごとのデフォルトタグを設定
      const platform = platforms[selectedPlatform];
      if (platform && platform.defaultTag) {
        affiliateTagInput.value = platform.defaultTag;
        localStorage.setItem(STORAGE_KEYS.affiliateTag, platform.defaultTag);
      }
    }

    // タグ変更時の処理
    function handleTagChange() {
      localStorage.setItem(STORAGE_KEYS.affiliateTag, affiliateTagInput.value);
    }

    // 変換処理
    function handleConvert() {
      const url = urlInput.value.trim();
      const platformKey = platformSelect.value;
      const tag = affiliateTagInput.value.trim();

      // エラーメッセージをクリア
      hideMessages();

      // 入力チェック
      if (!url) {
        showError('URLを入力してください。');
        return;
      }

      if (!tag) {
        showError('アフィリエイトタグを入力してください。');
        return;
      }

      const platform = platforms[platformKey];

      if (!platform || !platform.enabled) {
        showError('選択されたプラットフォームは現在利用できません。');
        return;
      }

      // 短縮URLのチェック
      if (platform.shortUrlPattern && platform.shortUrlPattern.test(url)) {
        showWarning('短縮URL（amzn.to）が検出されました。ブラウザで開いて展開されたURLをコピーしてください。');
        return;
      }

      // URLからプロダクトIDを抽出
      let productId = null;
      for (const pattern of platform.patterns) {
        const match = url.match(pattern);
        if (match) {
          productId = match[1];
          break;
        }
      }

      if (!productId) {
        showError(`有効な${platform.name}の商品URLではありません。URLを確認してください。`);
        return;
      }

      // アフィリエイトリンクを生成
      const affiliateLink = platform.generateLink(productId, tag);

      // 結果を表示
      showResult(affiliateLink);

      // 履歴に追加
      addToHistory(url, affiliateLink);
    }

    // 結果表示
    function showResult(link) {
      resultBox.textContent = link;
      resultSection.classList.add('show');
      copyButton.textContent = 'リンクをコピー';
      copyButton.classList.remove('copied');
    }

    // コピー処理
    function handleCopy() {
      const link = resultBox.textContent;

      if (!link) return;

      navigator.clipboard.writeText(link).then(() => {
        copyButton.textContent = 'コピーしました！';
        copyButton.classList.add('copied');

        setTimeout(() => {
          copyButton.textContent = 'リンクをコピー';
          copyButton.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        showError('コピーに失敗しました。手動でコピーしてください。');
      });
    }

    // エラー表示
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.add('show');
      resultSection.classList.remove('show');
    }

    // 警告表示
    function showWarning(message) {
      warningMessage.textContent = message;
      warningMessage.classList.add('show');
      resultSection.classList.remove('show');
    }

    // メッセージを隠す
    function hideMessages() {
      errorMessage.classList.remove('show');
      warningMessage.classList.remove('show');
    }

    // 履歴管理
    function addToHistory(originalUrl, affiliateLink) {
      let history = JSON.parse(localStorage.getItem(STORAGE_KEYS.conversionHistory) || '[]');

      // 新しい履歴アイテムを作成
      const historyItem = {
        originalUrl: originalUrl,
        affiliateLink: affiliateLink,
        timestamp: new Date().toISOString()
      };

      // 重複を削除（同じ元URLの古いエントリを削除）
      history = history.filter(item => item.originalUrl !== originalUrl);

      // 先頭に追加
      history.unshift(historyItem);

      // 最大10件まで保持
      history = history.slice(0, 10);

      // 保存
      localStorage.setItem(STORAGE_KEYS.conversionHistory, JSON.stringify(history));

      // 表示を更新
      loadHistory();
    }

    // 履歴を読み込む
    function loadHistory() {
      const history = JSON.parse(localStorage.getItem(STORAGE_KEYS.conversionHistory) || '[]');

      if (history.length === 0) {
        historySection.style.display = 'none';
        return;
      }

      historySection.style.display = 'block';
      historyList.innerHTML = '';

      history.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';

        const urlSpan = document.createElement('span');
        urlSpan.className = 'history-item-url';
        urlSpan.textContent = item.originalUrl;

        const dateSpan = document.createElement('span');
        dateSpan.className = 'history-item-date';
        const date = new Date(item.timestamp);
        dateSpan.textContent = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;

        historyItem.appendChild(urlSpan);
        historyItem.appendChild(dateSpan);

        // クリックで再利用
        historyItem.addEventListener('click', () => {
          urlInput.value = item.originalUrl;
          handleConvert();
        });

        historyList.appendChild(historyItem);
      });
    }

    // 履歴をクリア
    function clearHistory() {
      if (confirm('履歴をすべて削除しますか？')) {
        localStorage.removeItem(STORAGE_KEYS.conversionHistory);
        loadHistory();
      }
    }

    // 初期化実行
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>