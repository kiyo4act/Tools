<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0">
  <title>ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
  <meta name="version"
        content="1">
  <meta name="last-updated"
        content="2025-09-23">
  <meta name="description"
        content="EC ã‚µã‚¤ãƒˆã®å•†å“URLã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã«å¤‰æ›ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã€‚ç¾åœ¨ã¯Amazonã«å¯¾å¿œã€å°†æ¥çš„ã«æ¥½å¤©ç­‰ã‚‚å¯¾å¿œäºˆå®šã€‚">

  <script async
          src="https://www.googletagmanager.com/gtag/js?id=G-WWQTE7VWKG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-WWQTE7VWKG');
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 2rem;
      text-align: center;
    }

    .version-info {
      text-align: center;
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 20px;
    }

    .tool-description {
      background: #f0f4ff;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      color: #555;
      line-height: 1.6;
    }

    .platform-selector {
      margin: 20px 0;
      padding: 20px;
      background: #fafafa;
      border-radius: 10px;
    }

    .platform-label {
      display: block;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    select {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
      background: white;
      cursor: pointer;
      transition: border-color 0.3s;
    }

    select:focus {
      outline: none;
      border-color: #667eea;
    }

    .tag-settings {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .tag-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tag-input-label {
      font-size: 0.9rem;
      color: #555;
      white-space: nowrap;
    }

    .tag-input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 0.9rem;
    }

    .input-section {
      margin: 30px 0;
    }

    .input-label {
      display: block;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .url-input-group {
      display: flex;
      gap: 10px;
    }

    .url-input {
      flex: 1;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .url-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .convert-button {
      padding: 15px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .convert-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .convert-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .result-section {
      margin-top: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 10px;
      display: none;
    }

    .result-section.show {
      display: block;
    }

    .result-label {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }

    .result-box {
      background: white;
      border: 2px solid #4CAF50;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      word-break: break-all;
      font-family: 'Courier New', monospace;
      font-size: 0.95rem;
    }

    .copy-button {
      width: 100%;
      padding: 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .copy-button:hover {
      background: #45a049;
    }

    .copy-button.copied {
      background: #2196F3;
    }

    .error-message {
      background: #fee;
      border-left: 4px solid #f44336;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      color: #c00;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .warning-message {
      background: #fff8e1;
      border-left: 4px solid #ff9800;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      color: #f57c00;
      display: none;
    }

    .warning-message.show {
      display: block;
    }

    .usage-section {
      margin-top: 40px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .usage-section h3 {
      color: #333;
      margin-bottom: 15px;
    }

    .usage-section ol {
      padding-left: 25px;
      line-height: 2;
      color: #555;
    }

    .usage-section li {
      margin-bottom: 10px;
    }

    .supported-urls {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
    }

    .supported-urls h4 {
      color: #333;
      margin-bottom: 10px;
      font-size: 0.95rem;
    }

    .supported-urls ul {
      padding-left: 20px;
      color: #666;
    }

    .supported-urls li {
      margin: 5px 0;
      font-size: 0.9rem;
    }

    .supported-urls code {
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
    }

    .history-section {
      margin-top: 30px;
      padding: 20px;
      background: #f5f5f5;
      border-radius: 10px;
    }

    .history-title {
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .clear-history {
      padding: 5px 10px;
      background: #ff5252;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .clear-history:hover {
      background: #ff1744;
    }

    .history-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .history-item {
      background: white;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .history-item:hover {
      background: #e8eaf6;
    }

    .history-item-url {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: #555;
    }

    .history-item-date {
      color: #999;
      font-size: 0.8rem;
      margin-left: 10px;
    }

    .footer-note {
      text-align: center;
      color: #999;
      font-size: 0.85rem;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e0e0e0;
    }

    @media (max-width: 600px) {
      .container {
        padding: 25px;
      }

      h1 {
        font-size: 1.5rem;
      }

      .url-input-group {
        flex-direction: column;
      }

      .convert-button {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ”— ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
    <p class="version-info">æœ€çµ‚æ›´æ–°: 2025å¹´9æœˆ23æ—¥ (Ver. 1)</p>

    <div class="tool-description">
      ECã‚µã‚¤ãƒˆã®å•†å“URLã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã«è‡ªå‹•å¤‰æ›ã—ã¾ã™ã€‚<br>
      ç¾åœ¨ã¯Amazonã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ï¼ˆå°†æ¥çš„ã«æ¥½å¤©ç­‰ã‚‚å¯¾å¿œäºˆå®šï¼‰
    </div>

    <div class="platform-selector">
      <label class="platform-label"
             for="platform-select">ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’é¸æŠ:</label>
      <select id="platform-select">
        <option value="amazon">Amazon</option>
        <option value="rakuten"
                disabled>æ¥½å¤©ï¼ˆæº–å‚™ä¸­ï¼‰</option>
      </select>

      <div class="tag-settings">
        <div class="tag-input-group">
          <label class="tag-input-label"
                 for="affiliate-tag">ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚¿ã‚°:</label>
          <input type="text"
                 id="affiliate-tag"
                 class="tag-input"
                 value="konoe.studio-22"
                 placeholder="your-tag-22">
        </div>
      </div>
    </div>

    <div class="input-section">
      <label class="input-label"
             for="url-input">å•†å“ãƒšãƒ¼ã‚¸ã®URLã‚’å…¥åŠ›:</label>
      <div class="url-input-group">
        <input type="text"
               id="url-input"
               class="url-input"
               placeholder="https://www.amazon.co.jp/dp/B0FHCQF5YT">
        <button id="convert-button"
                class="convert-button">å¤‰æ›ã™ã‚‹</button>
      </div>
    </div>

    <div id="error-message"
         class="error-message"></div>
    <div id="warning-message"
         class="warning-message"></div>

    <div id="result-section"
         class="result-section">
      <div class="result-label">ç”Ÿæˆã•ã‚ŒãŸã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯:</div>
      <div id="result-box"
           class="result-box"></div>
      <button id="copy-button"
              class="copy-button">ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div id="history-section"
         class="history-section"
         style="display: none;">
      <div class="history-title">
        <span>ğŸ“ å¤‰æ›å±¥æ­´ï¼ˆæœ€æ–°10ä»¶ï¼‰</span>
        <button id="clear-history"
                class="clear-history">å±¥æ­´ã‚’ã‚¯ãƒªã‚¢</button>
      </div>
      <div id="history-list"
           class="history-list"></div>
    </div>

    <div class="usage-section">
      <h3>ğŸ“š ä½¿ã„æ–¹</h3>
      <ol>
        <li><strong>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’é¸æŠ</strong>: ç¾åœ¨ã¯Amazonã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™</li>
        <li><strong>ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚¿ã‚°ã‚’è¨­å®š</strong>: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®šæ¸ˆã¿ã§ã™ãŒã€å¤‰æ›´å¯èƒ½ã§ã™</li>
        <li><strong>å•†å“URLã‚’å…¥åŠ›</strong>: Amazonå•†å“ãƒšãƒ¼ã‚¸ã®URLã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆ</li>
        <li><strong>å¤‰æ›ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</strong>: ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™</li>
        <li><strong>ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</strong>: ç”Ÿæˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼</li>
      </ol>

      <div class="supported-urls">
        <h4>âœ… å¯¾å¿œã—ã¦ã„ã‚‹Amazon URLãƒ‘ã‚¿ãƒ¼ãƒ³:</h4>
        <ul>
          <li>å•†å“ãƒšãƒ¼ã‚¸: <code>https://www.amazon.co.jp/dp/B0XXXXXXXX</code></li>
          <li>å•†å“ãƒšãƒ¼ã‚¸ï¼ˆé•·ã„å½¢å¼ï¼‰: <code>https://www.amazon.co.jp/å•†å“å/dp/B0XXXXXXXX</code></li>
          <li>gp/productå½¢å¼: <code>https://www.amazon.co.jp/gp/product/B0XXXXXXXX</code></li>
        </ul>
      </div>

      <div class="supported-urls"
           style="margin-top: 15px; background: #fff8e1;">
        <h4>âš ï¸ çŸ­ç¸®URLï¼ˆamzn.toï¼‰ã«ã¤ã„ã¦:</h4>
        <ul style="color: #f57c00;">
          <li>çŸ­ç¸®URLã¯è‡ªå‹•å±•é–‹ã§ãã¾ã›ã‚“</li>
          <li>ãƒ–ãƒ©ã‚¦ã‚¶ã§çŸ­ç¸®URLã‚’é–‹ãã€å±•é–‹ã•ã‚ŒãŸURLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„</li>
        </ul>
      </div>
    </div>

    <p class="footer-note">
      ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‹•ä½œã—ã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚<br>
      è¨­å®šã¨URLã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
    </p>
  </div>

  <script>
    // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¨­å®šï¼ˆå°†æ¥ã®æ‹¡å¼µã‚’è€ƒæ…®ï¼‰
    const platforms = {
      amazon: {
        name: 'Amazon',
        enabled: true,
        defaultTag: 'konoe.studio-22',
        patterns: [
          /amazon\.co\.jp.*\/dp\/([A-Z0-9]{10})/i,
          /amazon\.co\.jp.*\/gp\/product\/([A-Z0-9]{10})/i
        ],
        shortUrlPattern: /amzn\.to\//i,
        generateLink: function (productId, tag) {
          return `https://www.amazon.co.jp/dp/${productId}?tag=${tag}&linkCode=ogi&th=1&psc=1`;
        }
      },
      rakuten: {
        name: 'æ¥½å¤©',
        enabled: false,
        defaultTag: '',
        patterns: [],
        generateLink: null
      }
    };

    // DOMè¦ç´ ã®å–å¾—
    const platformSelect = document.getElementById('platform-select');
    const affiliateTagInput = document.getElementById('affiliate-tag');
    const urlInput = document.getElementById('url-input');
    const convertButton = document.getElementById('convert-button');
    const errorMessage = document.getElementById('error-message');
    const warningMessage = document.getElementById('warning-message');
    const resultSection = document.getElementById('result-section');
    const resultBox = document.getElementById('result-box');
    const copyButton = document.getElementById('copy-button');
    const historySection = document.getElementById('history-section');
    const historyList = document.getElementById('history-list');
    const clearHistoryButton = document.getElementById('clear-history');

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚­ãƒ¼
    const STORAGE_KEYS = {
      affiliateTag: 'affiliate_tag',
      selectedPlatform: 'selected_platform',
      conversionHistory: 'conversion_history'
    };

    // åˆæœŸåŒ–
    function init() {
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è¨­å®šã‚’å¾©å…ƒ
      const savedTag = localStorage.getItem(STORAGE_KEYS.affiliateTag);
      const savedPlatform = localStorage.getItem(STORAGE_KEYS.selectedPlatform);

      if (savedTag) {
        affiliateTagInput.value = savedTag;
      }

      if (savedPlatform && platforms[savedPlatform] && platforms[savedPlatform].enabled) {
        platformSelect.value = savedPlatform;
      }

      // å±¥æ­´ã‚’è¡¨ç¤º
      loadHistory();

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
      platformSelect.addEventListener('change', handlePlatformChange);
      affiliateTagInput.addEventListener('input', handleTagChange);
      convertButton.addEventListener('click', handleConvert);
      copyButton.addEventListener('click', handleCopy);
      clearHistoryButton.addEventListener('click', clearHistory);

      // URLã®å…¥åŠ›ã§Enterã‚­ãƒ¼ã‚’æŠ¼ã—ãŸã¨ãã‚‚å¤‰æ›
      urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          handleConvert();
        }
      });
    }

    // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¤‰æ›´æ™‚ã®å‡¦ç†
    function handlePlatformChange() {
      const selectedPlatform = platformSelect.value;
      localStorage.setItem(STORAGE_KEYS.selectedPlatform, selectedPlatform);

      // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã”ã¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚°ã‚’è¨­å®š
      const platform = platforms[selectedPlatform];
      if (platform && platform.defaultTag) {
        affiliateTagInput.value = platform.defaultTag;
        localStorage.setItem(STORAGE_KEYS.affiliateTag, platform.defaultTag);
      }
    }

    // ã‚¿ã‚°å¤‰æ›´æ™‚ã®å‡¦ç†
    function handleTagChange() {
      localStorage.setItem(STORAGE_KEYS.affiliateTag, affiliateTagInput.value);
    }

    // å¤‰æ›å‡¦ç†
    function handleConvert() {
      const url = urlInput.value.trim();
      const platformKey = platformSelect.value;
      const tag = affiliateTagInput.value.trim();

      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
      hideMessages();

      // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
      if (!url) {
        showError('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      if (!tag) {
        showError('ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚¿ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      const platform = platforms[platformKey];

      if (!platform || !platform.enabled) {
        showError('é¸æŠã•ã‚ŒãŸãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ç¾åœ¨åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚');
        return;
      }

      // çŸ­ç¸®URLã®ãƒã‚§ãƒƒã‚¯
      if (platform.shortUrlPattern && platform.shortUrlPattern.test(url)) {
        showWarning('çŸ­ç¸®URLï¼ˆamzn.toï¼‰ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦å±•é–‹ã•ã‚ŒãŸURLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      // URLã‹ã‚‰ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆIDã‚’æŠ½å‡º
      let productId = null;
      for (const pattern of platform.patterns) {
        const match = url.match(pattern);
        if (match) {
          productId = match[1];
          break;
        }
      }

      if (!productId) {
        showError(`æœ‰åŠ¹ãª${platform.name}ã®å•†å“URLã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
        return;
      }

      // ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆ
      const affiliateLink = platform.generateLink(productId, tag);

      // çµæœã‚’è¡¨ç¤º
      showResult(affiliateLink);

      // å±¥æ­´ã«è¿½åŠ 
      addToHistory(url, affiliateLink);
    }

    // çµæœè¡¨ç¤º
    function showResult(link) {
      resultBox.textContent = link;
      resultSection.classList.add('show');
      copyButton.textContent = 'ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼';
      copyButton.classList.remove('copied');
    }

    // ã‚³ãƒ”ãƒ¼å‡¦ç†
    function handleCopy() {
      const link = resultBox.textContent;

      if (!link) return;

      navigator.clipboard.writeText(link).then(() => {
        copyButton.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
        copyButton.classList.add('copied');

        setTimeout(() => {
          copyButton.textContent = 'ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼';
          copyButton.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        showError('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
      });
    }

    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.add('show');
      resultSection.classList.remove('show');
    }

    // è­¦å‘Šè¡¨ç¤º
    function showWarning(message) {
      warningMessage.textContent = message;
      warningMessage.classList.add('show');
      resultSection.classList.remove('show');
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™
    function hideMessages() {
      errorMessage.classList.remove('show');
      warningMessage.classList.remove('show');
    }

    // å±¥æ­´ç®¡ç†
    function addToHistory(originalUrl, affiliateLink) {
      let history = JSON.parse(localStorage.getItem(STORAGE_KEYS.conversionHistory) || '[]');

      // æ–°ã—ã„å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½œæˆ
      const historyItem = {
        originalUrl: originalUrl,
        affiliateLink: affiliateLink,
        timestamp: new Date().toISOString()
      };

      // é‡è¤‡ã‚’å‰Šé™¤ï¼ˆåŒã˜å…ƒURLã®å¤ã„ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤ï¼‰
      history = history.filter(item => item.originalUrl !== originalUrl);

      // å…ˆé ­ã«è¿½åŠ 
      history.unshift(historyItem);

      // æœ€å¤§10ä»¶ã¾ã§ä¿æŒ
      history = history.slice(0, 10);

      // ä¿å­˜
      localStorage.setItem(STORAGE_KEYS.conversionHistory, JSON.stringify(history));

      // è¡¨ç¤ºã‚’æ›´æ–°
      loadHistory();
    }

    // å±¥æ­´ã‚’èª­ã¿è¾¼ã‚€
    function loadHistory() {
      const history = JSON.parse(localStorage.getItem(STORAGE_KEYS.conversionHistory) || '[]');

      if (history.length === 0) {
        historySection.style.display = 'none';
        return;
      }

      historySection.style.display = 'block';
      historyList.innerHTML = '';

      history.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';

        const urlSpan = document.createElement('span');
        urlSpan.className = 'history-item-url';
        urlSpan.textContent = item.originalUrl;

        const dateSpan = document.createElement('span');
        dateSpan.className = 'history-item-date';
        const date = new Date(item.timestamp);
        dateSpan.textContent = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;

        historyItem.appendChild(urlSpan);
        historyItem.appendChild(dateSpan);

        // ã‚¯ãƒªãƒƒã‚¯ã§å†åˆ©ç”¨
        historyItem.addEventListener('click', () => {
          urlInput.value = item.originalUrl;
          handleConvert();
        });

        historyList.appendChild(historyItem);
      });
    }

    // å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
    function clearHistory() {
      if (confirm('å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        localStorage.removeItem(STORAGE_KEYS.conversionHistory);
        loadHistory();
      }
    }

    // åˆæœŸåŒ–å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>