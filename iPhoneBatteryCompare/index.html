<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="今のiPhoneの電池残量(％)から、別のiPhoneだと何％になるかを比較するツール">
    <!-- OGP / Twitter Card -->
    <meta property="og:title" content="iPhoneバッテリー残量比較シミュレーター">
    <meta property="og:description" content="今のiPhoneの電池残量(％)から、別のiPhoneだと何％になるかを比較するツール">
    <meta property="og:image" content="https://kiyo.bio/Tools/iPhoneBatteryCompare/ogp.png">
    <meta property="og:url" content="https://kiyo.bio/Tools/iPhoneBatteryCompare/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="kiyo.bio">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="iPhoneバッテリー残量比較シミュレーター">
    <meta name="twitter:description" content="今のiPhoneの電池残量(％)から、別のiPhoneだと何％になるかを比較するツール">
    <meta name="twitter:image" content="https://kiyo.bio/Tools/iPhoneBatteryCompare/ogp.png">
    <meta name="last-updated" content="2026-01-29">
    <meta name="category" content="シミュレーション">
    <meta name="version" content="2.0">

    <title>iPhoneバッテリー残量比較シミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #F2F2F7;
            color: #1D1D1F;
        }

        .ios-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s ease;
        }

        .ios-btn-icon {
            color: #007AFF;
            background: rgba(0, 122, 255, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        /* Custom Range Slider */
        .ios-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 24px;
            background: transparent;
            cursor: pointer;
        }

        .ios-slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #E5E5EA;
            border-radius: 2px;
        }

        .ios-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #FFFFFF;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            margin-top: -12px;
            border: 0.5px solid rgba(0, 0, 0, 0.05);
        }

        /* Segmented Control */
        .segmented-control {
            display: flex;
            background: #E5E5EA;
            padding: 2px;
            border-radius: 8px;
            width: 100%;
        }

        .segmented-option {
            flex: 1;
            text-align: center;
            padding: 6px 0;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            color: #636366;
            transition: all 0.2s;
        }

        .segmented-option.active {
            background: white;
            color: #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }

        /* Static Badge */
        .sim-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #F2F2F7;
            color: #636366;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 8px;
            width: 100%;
            border: 1px solid #E5E5EA;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sim-badge i {
            margin-right: 6px;
            color: #8E8E93;
        }

        .battery-bar {
            transition: width 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), background-color 0.3s;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(2px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .modal-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            padding: 24px;
            transform: scale(0.95);
            transition: transform 0.2s;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-overlay.open .modal-content {
            transform: scale(1);
        }

        /* Table Style */
        .data-table {
            width: 100%;
            font-size: 0.75rem;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #E5E5EA;
        }

        .data-table th {
            font-weight: 600;
            color: #1D1D1F;
            background-color: #F9F9F9;
        }

        .data-table td {
            color: #636366;
        }

        select.model-select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236B7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

    <div class="max-w-xl w-full space-y-5">

        <!-- Header -->
        <div class="px-2">
            <h1 class="text-xl font-bold text-gray-900">iPhoneバッテリー残量比較シミュレーター</h1>
            <p class="text-xs text-gray-500 mb-2">今のiPhoneの電池残量(％)から、別のiPhoneだと何％になるかをシミュレーション</p>

            <!-- Collapsible Description -->
            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                <button onclick="toggleDescription()"
                    class="w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 transition text-left">
                    <span class="text-xs font-bold text-gray-600"><i class="fas fa-info-circle text-blue-500 mr-1"></i>
                        このツールについて詳しく見る</span>
                    <i id="descIcon"
                        class="fas fa-chevron-down text-gray-400 text-xs transition-transform transform"></i>
                </button>
                <div id="descriptionContent"
                    class="hidden p-4 text-xs text-gray-600 leading-relaxed border-t border-gray-200">
                    <p class="mb-3">
                        このツールは、あなたが現在使っているiPhoneのバッテリー消耗具合を基準にして、<strong>「もし別のiPhoneを使っていたら、今頃バッテリー残量は何％になっていたか？」</strong>を計算して比較できるシミュレーターです。
                    </p>
                    <p class="mb-3">
                        単純なバッテリー容量(mAh)の比較ではなく、Apple公式のビデオ再生時間などの仕様をベースに、あなたが設定した<strong>「バッテリーの最大容量（劣化具合）」</strong>や<strong>「充電上限」</strong>を考慮して、実際の体感に近い数値を算出します。
                    </p>
                    <p class="mb-4">
                        「今のiPhoneだとこの時間で充電が切れるけれど、新しいモデルならまだ残っているのか？」「バッテリー交換と買い替え、どちらが効果的か？」といった疑問を解決するためにご活用ください。
                    </p>

                    <div class="pt-3 border-t border-gray-100">
                        <button onclick="openSourceModal()"
                            class="text-blue-600 font-medium hover:underline flex items-center gap-1 px-2 py-1 rounded hover:bg-blue-50 transition w-full justify-center sm:w-auto sm:justify-start">
                            <i class="fas fa-table"></i> モデル別スペック詳細（各機種の公称値）はこちら
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SOURCE DEVICE -->
        <div class="ios-card p-5 border-l-4 border-blue-500">
            <div class="flex justify-between items-start mb-4">
                <span class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded">今のiPhone
                    (比較元)</span>

                <!-- Settings Area -->
                <div class="text-right flex items-center gap-4">
                    <!-- Limit -->
                    <div class="flex flex-col items-end">
                        <div class="flex items-center gap-1 mb-1">
                            <span class="text-[10px] text-gray-500">充電上限</span>
                            <button onclick="openExplainModal('limit')" class="text-gray-400 hover:text-blue-500"><i
                                    class="fas fa-info-circle text-[10px]"></i></button>
                        </div>
                        <select id="limitSelect"
                            class="text-sm font-bold text-blue-600 bg-transparent focus:outline-none text-right appearance-none cursor-pointer pr-3">
                            <option value="80">80%</option>
                            <option value="85">85%</option>
                            <option value="90">90%</option>
                            <option value="95">95%</option>
                            <option value="100">100%</option>
                        </select>
                    </div>

                    <!-- Health -->
                    <div class="flex flex-col items-end">
                        <div class="flex items-center gap-1 mb-1">
                            <span class="text-[10px] text-gray-500">最大容量</span>
                            <button onclick="openExplainModal('health')" class="text-gray-400 hover:text-blue-500"><i
                                    class="fas fa-info-circle text-[10px]"></i></button>
                        </div>
                        <div class="flex items-center">
                            <input type="number" id="sourceHealth" value="100" min="50" max="100"
                                class="w-10 text-right text-sm font-bold border-b border-gray-200 focus:border-blue-500 focus:outline-none text-blue-600"
                                oninput="validateHealth(this)">
                            <span class="text-xs text-gray-400 ml-1">%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model & SIM -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-3 mb-4">
                <div class="md:col-span-3">
                    <select id="sourceModel"
                        class="model-select w-full bg-gray-100 rounded-lg p-2 text-sm font-medium border-none appearance-none cursor-pointer text-gray-800">
                        <!-- Options generated by JS -->
                    </select>
                </div>
                <div class="md:col-span-2" id="sourceSimContainer"></div>
            </div>

            <div class="space-y-1">
                <div class="flex justify-between items-baseline px-1">
                    <span class="text-xs text-gray-500">現在の残量</span>
                    <span id="inputPercentDisplay" class="text-2xl font-bold tabular-nums text-gray-800">100%</span>
                </div>
                <div class="relative h-10 bg-gray-100 rounded-xl overflow-hidden border border-gray-200 mb-2">
                    <div id="inputBar" class="battery-bar absolute top-0 left-0 h-full bg-blue-500"
                        style="width: 100%;"></div>
                </div>
                <input type="range" id="batterySlider" min="0" max="100" value="100" class="ios-slider">
            </div>

            <div class="mt-3 pt-3 border-t border-gray-100 flex justify-between text-[10px] text-gray-400">
                <span>公称値: <span id="sourceBaseHours" class="font-medium text-gray-600">-- h</span></span>
                <span>補正後の持ち時間: <span id="sourceRealHours" class="font-bold text-blue-600">-- h</span></span>
            </div>
        </div>

        <!-- Arrow -->
        <div class="flex justify-center -my-3 relative z-10">
            <div
                class="bg-white rounded-full px-4 py-1.5 shadow-sm border border-gray-100 text-gray-500 text-[10px] flex items-center gap-2">
                <i class="fas fa-stopwatch text-blue-400"></i>
                <span id="transferTimeDisplay" class="font-bold">-- 時間</span>
                <span class="text-gray-400">経過</span>
                <i class="fas fa-arrow-down text-gray-300"></i>
            </div>
        </div>

        <!-- TARGETS CONTAINER -->
        <div id="targetsContainer" class="space-y-5">
            <!-- Dynamic Target Cards will be injected here -->
        </div>

        <!-- ADD BUTTON -->
        <div class="text-center pt-2 pb-6">
            <button onclick="addTarget()"
                class="bg-white text-indigo-600 hover:bg-indigo-50 border border-indigo-200 font-bold py-3 px-8 rounded-full shadow-sm hover:shadow-md transition-all transform hover:-translate-y-0.5 flex items-center gap-2 mx-auto text-sm">
                <i class="fas fa-plus-circle"></i> 比較対象を追加
            </button>
        </div>

    </div>

    <!-- MODALS -->

    <!-- Data Source Modal -->
    <div id="sourceModal" class="modal-overlay" onclick="closeModals(event)">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">全モデル スペック一覧</h3>
                <button onclick="closeModals()" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>

            <p class="text-xs text-gray-500 mb-4">
                ビデオ再生時間（最大）はApple公式サイトの技術仕様に基づきます。<br>
                eSIM版とUSIM版の仕様差については、物理的なバッテリー容量差(mAh)を時間に換算して算出しています。
            </p>

            <div class="overflow-x-auto">
                <table class="data-table">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="p-2 text-left">モデル</th>
                            <th class="p-2 text-left">ビデオ再生</th>
                            <th class="p-2 text-left">ストリーミング</th>
                            <th class="p-2 text-center">Link</th>
                        </tr>
                    </thead>
                    <tbody id="specsTableBody">
                        <!-- JS injected -->
                    </tbody>
                </table>
            </div>

            <div class="pt-4 mt-4 border-t border-gray-200 text-center">
                <a href="https://www.apple.com/jp/iphone/compare/" target="_blank"
                    class="inline-flex items-center gap-2 text-xs text-white bg-blue-600 px-4 py-2 rounded-full hover:bg-blue-700 transition">
                    <i class="fas fa-external-link-alt"></i> Apple公式サイトで比較する
                </a>
            </div>
        </div>
    </div>

    <!-- Explain Modal -->
    <div id="explainModal" class="modal-overlay" onclick="closeModals(event)">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 id="explainTitle" class="font-bold text-lg">用語解説</h3>
                <button onclick="closeModals()" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div id="explainBody" class="text-sm text-gray-700 leading-relaxed space-y-3"></div>
        </div>
    </div>

    <script>
        // --- DATA ---
        // Models definition ensuring correct grouping and sorting.
        // iPhone 17 (2025 Model) - Specs are treated as factual based on 2026 context.
        // Values: h = Video Playback Hours (Official/Specs)

        const MODELS = [
            // iPhone 17 Series (2025)
            {
                id: '17pm', name: 'iPhone 17 Pro Max', group: 'iPhone 17 Series', type: 'variant',
                variants: {
                    'esim': { video: 39.0, streaming: 35.0, label: 'eSIMのみ', url: 'https://support.apple.com/ja-jp/125091' },
                    'usim': { video: 37.0, streaming: 33.0, label: 'USIM対応', url: 'https://support.apple.com/en-gb/125091' }
                },
                url: 'https://support.apple.com/ja-jp/125091'
            },
            {
                id: '17pro', name: 'iPhone 17 Pro', group: 'iPhone 17 Series', type: 'variant',
                variants: {
                    'esim': { video: 33.0, streaming: 30.0, label: 'eSIMのみ', url: 'https://support.apple.com/ja-jp/125090' },
                    'usim': { video: 31.0, streaming: 28.0, label: 'USIM対応', url: 'https://support.apple.com/en-gb/125090' }
                },
                url: 'https://support.apple.com/ja-jp/125090'
            },
            {
                id: '17', name: 'iPhone 17', group: 'iPhone 17 Series', type: 'variant',
                variants: {
                    'esim': { video: 30.0, streaming: 27.0, label: 'eSIMのみ', url: 'https://support.apple.com/ja-jp/125089' },
                    'usim': { video: 30.0, streaming: 27.0, label: 'USIM対応', url: 'https://support.apple.com/en-gb/125089' }
                },
                url: 'https://support.apple.com/ja-jp/125089'
            },
            {
                id: 'air', name: 'iPhone Air', group: 'iPhone 17 Series', type: 'fixed',
                video: 27.0, streaming: 22.0, label: 'eSIMのみ',
                url: 'https://support.apple.com/ja-jp/125092'
            },

            // iPhone 16 Series
            { id: '16pm', name: 'iPhone 16 Pro Max', group: 'iPhone 16 Series', type: 'fixed', video: 33.0, streaming: 29.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/121032' },
            { id: '16pro', name: 'iPhone 16 Pro', group: 'iPhone 16 Series', type: 'fixed', video: 27.0, streaming: 22.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/121031' },
            { id: '16plus', name: 'iPhone 16 Plus', group: 'iPhone 16 Series', type: 'fixed', video: 27.0, streaming: 24.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/121030' },
            { id: '16', name: 'iPhone 16', group: 'iPhone 16 Series', type: 'fixed', video: 22.0, streaming: 18.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/121029' },
            { id: '16e', name: 'iPhone 16e', group: 'iPhone 16 Series', type: 'fixed', video: 26.0, streaming: 21.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/122208' },

            // iPhone 15 Series
            { id: '15pm', name: 'iPhone 15 Pro Max', group: 'iPhone 15 Series', type: 'fixed', video: 29.0, streaming: 25.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111828' },
            { id: '15pro', name: 'iPhone 15 Pro', group: 'iPhone 15 Series', type: 'fixed', video: 23.0, streaming: 20.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111829' },
            { id: '15plus', name: 'iPhone 15 Plus', group: 'iPhone 15 Series', type: 'fixed', video: 26.0, streaming: 20.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111830' },
            { id: '15', name: 'iPhone 15', group: 'iPhone 15 Series', type: 'fixed', video: 20.0, streaming: 16.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111831' },

            // iPhone 14 Series
            { id: '14pm', name: 'iPhone 14 Pro Max', group: 'iPhone 14 Series', type: 'fixed', video: 29.0, streaming: 25.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111846' },
            { id: '14pro', name: 'iPhone 14 Pro', group: 'iPhone 14 Series', type: 'fixed', video: 23.0, streaming: 20.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111849' },
            { id: '14plus', name: 'iPhone 14 Plus', group: 'iPhone 14 Series', type: 'fixed', video: 26.0, streaming: 20.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111854' },
            { id: '14', name: 'iPhone 14', group: 'iPhone 14 Series', type: 'fixed', video: 20.0, streaming: 16.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111850' },

            // iPhone 13 Series
            { id: '13pm', name: 'iPhone 13 Pro Max', group: 'iPhone 13 Series', type: 'fixed', video: 28.0, streaming: 25.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111870' },
            { id: '13pro', name: 'iPhone 13 Pro', group: 'iPhone 13 Series', type: 'fixed', video: 22.0, streaming: 20.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111871' },
            { id: '13', name: 'iPhone 13', group: 'iPhone 13 Series', type: 'fixed', video: 19.0, streaming: 15.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111872' },
            { id: '13mini', name: 'iPhone 13 mini', group: 'iPhone 13 Series', type: 'fixed', video: 17.0, streaming: 13.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111873' },

            // iPhone 12 Series
            { id: '12pm', name: 'iPhone 12 Pro Max', group: 'iPhone 12 Series', type: 'fixed', video: 20.0, streaming: 12.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111874' },
            { id: '12pro', name: 'iPhone 12 Pro', group: 'iPhone 12 Series', type: 'fixed', video: 17.0, streaming: 11.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111875' },
            { id: '12', name: 'iPhone 12', group: 'iPhone 12 Series', type: 'fixed', video: 17.0, streaming: 11.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111876' },
            { id: '12mini', name: 'iPhone 12 mini', group: 'iPhone 12 Series', type: 'fixed', video: 15.0, streaming: 10.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111877' },

            // iPhone 11 Series (2019)
            { id: '11pm', name: 'iPhone 11 Pro Max', group: 'iPhone 11 Series', type: 'fixed', video: 20.0, streaming: 12.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111878' },
            { id: '11pro', name: 'iPhone 11 Pro', group: 'iPhone 11 Series', type: 'fixed', video: 18.0, streaming: 11.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111879' },
            { id: '11', name: 'iPhone 11', group: 'iPhone 11 Series', type: 'fixed', video: 17.0, streaming: 10.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111865' },

            // iPhone SE
            { id: 'se3', name: 'iPhone SE (第3世代)', group: 'iPhone SE', type: 'fixed', video: 15.0, streaming: 10.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111866' },
            { id: 'se2', name: 'iPhone SE (第2世代)', group: 'iPhone SE', type: 'fixed', video: 13.0, streaming: 8.0, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111882' },

            // iPhone XS / XR (2018)
            { id: 'xsmax', name: 'iPhone XS Max', group: 'iPhone XS / XR Series', type: 'fixed', video: 15.0, streaming: null, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111880' },
            { id: 'xs', name: 'iPhone XS', group: 'iPhone XS / XR Series', type: 'fixed', video: 14.0, streaming: null, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111881' },
            { id: 'xr', name: 'iPhone XR', group: 'iPhone XS / XR Series', type: 'fixed', video: 16.0, streaming: null, label: 'Nano-SIM + eSIM', url: 'https://support.apple.com/ja-jp/111868' },

            // iPhone X (2017)
            { id: 'x', name: 'iPhone X', group: 'iPhone X', type: 'fixed', video: 13.0, streaming: null, label: 'Nano-SIM', url: 'https://support.apple.com/ja-jp/111864' },

            // iPhone 8 Series (2017)
            { id: '8plus', name: 'iPhone 8 Plus', group: 'iPhone 8 Series', type: 'fixed', video: 14.0, streaming: null, label: 'Nano-SIM', url: 'https://support.apple.com/ja-jp/111950' },
            { id: '8', name: 'iPhone 8', group: 'iPhone 8 Series', type: 'fixed', video: 13.0, streaming: null, label: 'Nano-SIM', url: 'https://support.apple.com/ja-jp/111976' },

            // iPhone 7 Series (2016)
            { id: '7plus', name: 'iPhone 7 Plus', group: 'iPhone 7 Series', type: 'fixed', video: 14.0, streaming: null, label: 'Nano-SIM', url: 'https://support.apple.com/ja-jp/111953' },
            { id: '7', name: 'iPhone 7', group: 'iPhone 7 Series', type: 'fixed', video: 13.0, streaming: null, label: 'Nano-SIM', url: 'https://support.apple.com/ja-jp/111943' },
        ];

        // Helper map for quick access
        const MODEL_MAP = MODELS.reduce((acc, m) => { acc[m.id] = m; return acc; }, {});

        // --- STATE ---
        let state = {
            limit: 100, // Default 100
            currentVal: 100,
            source: { model: '12pro', variant: 'fixed', health: 100 },
            targets: [
                { model: '17pro', variant: 'esim', health: 100 }
            ]
        };

        const $ = (id) => document.getElementById(id);

        function init() {
            // Source Init
            const sourceModelSelect = $('sourceModel');
            sourceModelSelect.innerHTML = getModelOptionsHTML();
            sourceModelSelect.value = state.source.model;
            $('sourceHealth').value = state.source.health;
            $('limitSelect').value = state.limit;

            // Events Source / Global
            $('limitSelect').addEventListener('change', (e) => {
                state.limit = parseInt(e.target.value);
                updateSliderRange();
            });

            $('batterySlider').addEventListener('input', (e) => {
                state.currentVal = parseInt(e.target.value);
                calculate();
            });

            // Source Listeners
            sourceModelSelect.addEventListener('change', (e) => {
                state.source.model = e.target.value;
                const mData = MODEL_MAP[e.target.value];
                state.source.variant = mData.type === 'variant' ? 'esim' : 'fixed';
                renderSimUI('source');
                calculate();
            });

            $('sourceHealth').addEventListener('input', (e) => {
                let v = parseInt(e.target.value);
                if (isNaN(v)) v = 100;
                if (v > 100) v = 100;
                state.source.health = v;
                calculate();
            });

            populateSpecsTable();
            renderSimUI('source');

            // Render Targets
            renderTargets();

            updateSliderRange();
        }

        // --- TARGET MANAGEMENT ---

        function addTarget() {
            // Add a default target
            state.targets.push({ model: '17pro', variant: 'esim', health: 100 });
            renderTargets();
        }

        function removeTarget(index) {
            state.targets.splice(index, 1);
            renderTargets();
        }

        function renderTargets() {
            const container = $('targetsContainer');
            container.innerHTML = '';

            state.targets.forEach((target, index) => {
                // Create Card
                const card = document.createElement('div');
                card.className = 'ios-card p-5 border-l-4 border-indigo-500 bg-gray-50/80 relative transition-all duration-300';
                card.innerHTML = generateTargetHTML(index, target, state.targets.length > 1);
                container.appendChild(card);

                // Attach Events
                const modelSelect = document.getElementById(`targetModel-${index}`);
                const healthInput = document.getElementById(`targetHealth-${index}`);

                modelSelect.addEventListener('change', (e) => {
                    target.model = e.target.value;
                    const mData = MODEL_MAP[e.target.value];
                    target.variant = mData.type === 'variant' ? 'esim' : 'fixed';
                    renderSimUI('target', index);
                    calculate();
                });

                healthInput.addEventListener('input', (e) => {
                    let v = parseInt(e.target.value);
                    if (isNaN(v)) v = 100;
                    if (v > 100) v = 100;
                    target.health = v;
                    calculate();
                });

                // Init SIM UI for this target
                renderSimUI('target', index);
            });

            calculate();
        }

        function generateTargetHTML(index, target, showRemove) {
            const removeBtn = showRemove
                ? `<button onclick="removeTarget(${index})" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 transition"><i class="fas fa-trash-alt"></i></button>`
                : '';

            return `
                ${removeBtn}
                <div class="flex justify-between items-start mb-4 pr-6">
                    <span class="text-[10px] font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded">比較したいiPhone (${index + 1})</span>

                    <div class="text-right">
                        <div class="flex items-center justify-end gap-1 mb-1">
                            <span class="text-[10px] text-gray-500">最大容量</span>
                        </div>
                        <div class="flex items-center justify-end">
                            <input type="number" id="targetHealth-${index}" value="${target.health}" min="50" max="100"
                                class="w-10 text-right text-sm font-bold border-b border-gray-200 focus:border-indigo-500 focus:outline-none bg-transparent text-indigo-600">
                            <span class="text-xs text-gray-400 ml-1">%</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-5 gap-3 mb-4">
                    <div class="md:col-span-3">
                        <select id="targetModel-${index}"
                            class="model-select w-full bg-white border border-gray-200 rounded-lg p-2 text-sm font-medium appearance-none cursor-pointer">
                            ${getModelOptionsHTML(target.model)}
                        </select>
                    </div>
                    <div class="md:col-span-2" id="targetSimContainer-${index}"></div>
                </div>

                <div class="space-y-2">
                    <div class="flex justify-between items-baseline px-1">
                        <span class="text-xs text-gray-500">推定残量</span>
                        <span id="outputPercentDisplay-${index}" class="text-2xl font-bold tabular-nums text-indigo-600">--%</span>
                    </div>
                    <div class="relative h-10 bg-gray-200 rounded-xl overflow-hidden border border-gray-200">
                        <div id="outputBar-${index}" class="battery-bar absolute top-0 left-0 h-full bg-indigo-500"
                            style="width: 0%;"></div>
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <span id="diffText-${index}" class="text-xs font-bold text-white drop-shadow-md opacity-90"></span>
                        </div>
                    </div>
                </div>

                <div class="mt-3 pt-3 border-t border-gray-200 flex justify-between text-[10px] text-gray-400">
                    <span>公称値: <span id="targetBaseHours-${index}" class="font-medium text-gray-600">-- h</span></span>
                    <span>補正後の持ち時間: <span id="targetRealHours-${index}" class="font-bold text-indigo-600">-- h</span></span>
                </div>

                <div class="text-right mt-2">
                    <p id="percentDiffDisplay-${index}" class="font-bold text-sm">--</p>
                </div>
            `;
        }

        // --- HELPERS ---

        function getModelOptionsHTML(selectedValue = '') {
            let html = '';
            let currentGroup = '';

            MODELS.forEach(m => {
                if (m.group !== currentGroup) {
                    if (currentGroup !== '') html += '</optgroup>';
                    html += `<optgroup label="${m.group}">`;
                    currentGroup = m.group;
                }
                const selected = m.id === selectedValue ? 'selected' : '';
                html += `<option value="${m.id}" ${selected}>${m.name}</option>`;
            });
            html += '</optgroup>';
            return html;
        }

        function populateSpecsTable() {
            const tbody = $('specsTableBody');
            let html = '';
            MODELS.forEach(m => {
                if (m.type === 'variant') {
                    // eSIM
                    const urlEsim = m.variants.esim.url || m.url;
                    const linkEsim = `<a href="${urlEsim}" target="_blank" class="text-blue-500 hover:text-blue-700 px-2"><i class="fas fa-external-link-alt"></i></a>`;
                    html += `<tr><td>${m.name} (${m.variants.esim.label})</td><td>最大 ${m.variants.esim.video}h</td><td>最大 ${m.variants.esim.streaming}h</td><td class="text-center">${linkEsim}</td></tr>`;

                    // USIM
                    const urlUsim = m.variants.usim.url || m.url;
                    const linkUsim = `<a href="${urlUsim}" target="_blank" class="text-blue-500 hover:text-blue-700 px-2"><i class="fas fa-external-link-alt"></i></a>`;
                    html += `<tr><td>${m.name} (${m.variants.usim.label})</td><td>最大 ${m.variants.usim.video}h</td><td>最大 ${m.variants.usim.streaming}h</td><td class="text-center">${linkUsim}</td></tr>`;
                } else {
                    const link = `<a href="${m.url}" target="_blank" class="text-blue-500 hover:text-blue-700 px-2"><i class="fas fa-external-link-alt"></i></a>`;
                    const streamVal = m.streaming ? `最大 ${m.streaming}h` : '<span class="text-gray-400">-</span>';
                    html += `<tr><td>${m.name}</td><td>最大 ${m.video}h</td><td>${streamVal}</td><td class="text-center">${link}</td></tr>`;
                }
            });
            tbody.innerHTML = html;
        }

        // --- DYNAMIC SIM UI ---
        function renderSimUI(type, index = null) {
            let containerId, modelKey, currentVar;

            if (type === 'source') {
                containerId = 'sourceSimContainer';
                modelKey = state.source.model;
                currentVar = state.source.variant;
            } else {
                containerId = `targetSimContainer-${index}`;
                modelKey = state.targets[index].model;
                currentVar = state.targets[index].variant;
            }

            const container = $(containerId);
            if (!container) return; // Safety

            const modelData = MODEL_MAP[modelKey];
            container.innerHTML = ''; // Clear

            if (modelData.type === 'variant') {
                // RENDER TOGGLE
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2 h-full';

                const control = document.createElement('div');
                control.className = 'segmented-control flex-1 h-full items-center';

                // Japan Option
                const opt1 = document.createElement('div');
                opt1.className = `segmented-option ${currentVar === 'esim' ? 'active' : ''}`;
                opt1.innerHTML = '日本版';
                opt1.onclick = () => setVariant(type, 'esim', index);

                // Overseas Option
                const opt2 = document.createElement('div');
                opt2.className = `segmented-option ${currentVar === 'usim' ? 'active' : ''}`;
                opt2.innerHTML = '海外版';
                opt2.onclick = () => setVariant(type, 'usim', index);

                control.appendChild(opt1);
                control.appendChild(opt2);
                div.appendChild(control);

                // Help Button
                const btn = document.createElement('button');
                btn.className = 'text-gray-400 hover:text-blue-500 w-6 flex-shrink-0 text-center';
                btn.innerHTML = '<i class="fas fa-question-circle"></i>';
                btn.onclick = () => openExplainModal('sim');
                div.appendChild(btn);

                container.appendChild(div);

            } else {
                // RENDER STATIC BADGE
                const badge = document.createElement('div');
                badge.className = 'sim-badge';
                const iconClass = modelData.label.includes('eSIM') ? 'fas fa-sim-card' : 'fas fa-mobile';
                badge.innerHTML = `<i class="${iconClass}"></i> ${modelData.label}`;
                container.appendChild(badge);
            }
        }

        window.setVariant = function (type, variant, index = null) {
            if (type === 'source') {
                state.source.variant = variant;
                renderSimUI('source');
            } else {
                state.targets[index].variant = variant;
                renderSimUI('target', index);
            }
            calculate();
        }

        function updateSliderRange() {
            const s = $('batterySlider');
            s.max = state.limit;
            if (state.currentVal > state.limit) state.currentVal = state.limit;
            s.value = state.currentVal;
            calculate();
        }

        function getHours(type, index = null) {
            let s;
            if (type === 'source') {
                s = state.source;
            } else {
                s = state.targets[index];
            }
            const m = MODEL_MAP[s.model];

            let baseH = 0;
            let baseStream = 0;
            if (m.type === 'variant') {
                baseH = m.variants[s.variant].video;
                baseStream = m.variants[s.variant].streaming;
            } else {
                baseH = m.video;
                baseStream = m.streaming;
            }

            // Health Impact
            const realH = baseH * (s.health / 100);
            return { baseH, baseStream, realH };
        }

        function calculate() {
            // SOURCE CALC
            const sTime = getHours('source');

            // Text Specs for Source
            const sStream = sTime.baseStream ? ` / ストリーミング: ${sTime.baseStream.toFixed(0)}h` : '';
            $('sourceBaseHours').innerHTML = `<span class="text-[10px] text-gray-500">ビデオ再生:</span> <span class="font-medium text-gray-800">${sTime.baseH.toFixed(1)}h</span><span class="text-[9px] text-gray-400 block sm:inline sm:ml-2">ストリーミング: ${sTime.baseStream ? sTime.baseStream.toFixed(1) + 'h' : '-'}</span>`;
            $('sourceRealHours').innerText = sTime.realH.toFixed(1) + 'h';

            // UI Input Update
            $('inputPercentDisplay').innerText = state.currentVal + '%';
            $('inputBar').style.width = state.currentVal + '%';
            setColor($('inputBar'), state.currentVal, 'source');

            // Calculation Core
            const consumedPercent = state.limit - state.currentVal;
            const consumedHours = sTime.realH * (consumedPercent / 100);

            // Time text
            const h = Math.floor(consumedHours);
            const m = Math.round((consumedHours - h) * 60);
            $('transferTimeDisplay').innerText = `${h}時間 ${m}分`;

            // TARGETS CALC LOOP
            state.targets.forEach((target, index) => {
                const tTime = getHours('target', index);

                // Target Calc
                const targetConsumedPercent = (consumedHours / tTime.realH) * 100;
                let targetRemaining = state.limit - targetConsumedPercent;
                if (targetRemaining < 0) targetRemaining = 0;

                // Update UI per target
                const elOutputPct = $(`outputPercentDisplay-${index}`);
                const elOutputBar = $(`outputBar-${index}`);
                const elBaseHours = $(`targetBaseHours-${index}`);
                const elRealHours = $(`targetRealHours-${index}`);

                if (elOutputPct) elOutputPct.innerText = targetRemaining.toFixed(1) + '%';
                if (elOutputBar) {
                    elOutputBar.style.width = targetRemaining + '%';
                    setColor(elOutputBar, targetRemaining, 'target');
                }

                if (elBaseHours) elBaseHours.innerHTML = `<span class="text-[10px] text-gray-500">ビデオ再生:</span> <span class="font-medium text-gray-800">${tTime.baseH.toFixed(1)}h</span><span class="text-[9px] text-gray-400 block sm:inline sm:ml-2">ストリーミング: ${tTime.baseStream ? tTime.baseStream.toFixed(1) + 'h' : '-'}</span>`;
                if (elRealHours) elRealHours.innerText = tTime.realH.toFixed(1) + 'h';

                // Diff
                const diff = targetRemaining - state.currentVal;
                const diffEl = $(`percentDiffDisplay-${index}`);
                const diffText = $(`diffText-${index}`);

                if (diffEl && diffText) {
                    if (diff < -0.1) {
                        diffText.innerText = `相手が ${Math.abs(diff).toFixed(1)}% 低い`;
                        diffEl.innerText = `${diff.toFixed(1)}%`;
                        diffEl.className = "font-bold text-sm text-red-500";
                    } else if (diff > 0.1) {
                        diffText.innerText = `相手が ${Math.abs(diff).toFixed(1)}% 高い`;
                        diffEl.innerText = `+${diff.toFixed(1)}%`;
                        diffEl.className = "font-bold text-sm text-green-500";
                    } else {
                        diffText.innerText = `同等`;
                        diffEl.innerText = `±0%`;
                        diffEl.className = "font-bold text-sm text-gray-400";
                    }
                }
            });
        }

        function setColor(el, val, type) {
            el.className = 'battery-bar absolute top-0 left-0 h-full';
            const base = type === 'source' ? 'bg-blue-500' : 'bg-indigo-500';
            if (val <= 20) el.classList.add('bg-red-500');
            else el.classList.add(base);
        }

        function validateHealth(el) {
            // UI helper only
        }

        // Modal Helpers
        window.openSourceModal = () => $('sourceModal').classList.add('open');
        window.openExplainModal = (t) => {
            const title = $('explainTitle');
            const body = $('explainBody');
            if (t === 'limit') {
                title.innerText = "充電上限の設定";
                body.innerHTML = "<p class='mb-2'><strong>「設定」>「バッテリー」>「充電」</strong>にある「充電上限」の設定値です。</p><p>バッテリー寿命を延ばすために上限を80%などに制限している場合、その状態で1日使えるかをシミュレーションする際に変更してください。</p>";
            } else if (t === 'health') {
                title.innerText = "バッテリーの最大容量";
                body.innerHTML = "<p class='mb-2'><strong>「設定」>「バッテリー」>「バッテリーの状態と充電」</strong>にある「最大容量」の数値です。</p><p>長く使ってバッテリーが劣化した状態（例えば85%など）でも十分な電池持ちがあるかを確認したい時に変更してください。</p>";
            } else if (t === 'sim') {
                title.innerText = "日本版と海外版の違い";
                body.innerHTML = "<ul class='list-disc pl-5 space-y-2'><li><strong>日本版:</strong> eSIM専用モデルです。物理SIMカードは挿入できません。日本版以外にも米国版やカナダ版、その他グローバル版でもeSIM専用モデルはこちらに該当します。</li><li><strong>海外版:</strong> グローバル版のうち、物理SIM+eSIMに対応しているモデルはこちらを選択します。eSIM専用モデルと比べてバッテリー容量が少ないです。（iPhone 17は同じ容量）</li></ul><p class='mt-2'>※本ツールではわかりやすくするため、eSIM専用モデル＝日本版、物理SIM対応モデル＝海外版と表記しています。</p>";
            }
            $('explainModal').classList.add('open');
        }
        window.closeModals = (e) => {
            if (!e || e.target.classList.contains('modal-overlay') || e.target.closest('button')) {
                document.querySelectorAll('.modal-overlay').forEach(el => el.classList.remove('open'));
            }
        }

        window.toggleDescription = () => {
            const content = $('descriptionContent');
            const icon = $('descIcon');
            content.classList.toggle('hidden');
            if (content.classList.contains('hidden')) {
                icon.style.transform = 'rotate(0deg)';
            } else {
                icon.style.transform = 'rotate(180deg)';
            }
        }

        init();
    </script>
</body>

</html>