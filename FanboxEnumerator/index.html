<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FANBOX支援者リスト抽出ツール</title>
    <meta name="version" content="1.1"> <meta name="last-updated" content="2025-05-30">
    <meta name="description" content="Pixiv FANBOXの支援者一覧ページから情報を抽出し、CSVまたはJSON形式でダウンロードするツールです。">
    <link rel="stylesheet" href="style.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WWQTE7VWKG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-WWQTE7VWKG');
    </script>
</head>
<body>
    <div class="container">
        <h1>FANBOX支援者リスト抽出ツール</h1>
        <p class="version-info">最終更新: 2025年5月30日 (Rev. 1.1)</p> <p class="tool-description">
            Pixiv FANBOXの支援者一覧ページのURLまたはHTMLソースから、支援者情報を抽出し、CSVまたはJSON形式でダウンロードします。<br>
            プランや支援期間でのフィルタリング、ソート機能も備えています。
        </p>

        <div class="instructions">
            <div class="usage-section">
                <h4>基本的な使い方</h4>
                <ol>
                    <li>
                        <strong>FANBOX情報の入力:</strong>
                        <ul>
                            <li><strong>URLから読み込む場合:</strong>
                                <ol type="a">
                                    <li>「プロキシサーバー」を選択します。（通常はデフォルトのままで問題ありません）</li>
                                    <li>「FanboxクリエイターID」または「支援者一覧ページのフルURL」を入力します。
                                        <br><small>クリエイターID例: <code>yourcreatorid</code> (<code>https://yourcreatorid.fanbox.cc/</code> の場合)</small>
                                        <br><small>フルURL例: <code>https://yourcreatorid.fanbox.cc/manage/relationships</code></small>
                                    </li>
                                    <li>「URLからHTML読み込み」ボタンを押すと、下の「HTMLソース」欄に読み込まれたHTMLが表示されます。</li>
                                </ol>
                            </li>
                            <li><strong>HTMLを直接入力する場合:</strong>
                                <ol type="a">
                                    <li>ブラウザでFanboxの支援者一覧ページを開き、ページのソースコード（または支援者リストが表示されている範囲のHTML）を手動でコピーします。</li>
                                    <li>下の「HTMLソース」欄に貼り付けます。</li>
                                </ol>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <strong>解析実行:</strong>
                        <p>「HTMLソース」欄にHTMLが表示（または貼り付け）されている状態で、「このHTMLを解析実行」ボタンを押します。</p>
                    </li>
                    <li>
                        <strong>フィルタリングとソート (任意):</strong>
                        <p>抽出結果が表示されたら、「プランフィルター」「支援期間フィルター」「ソート」で表示を絞り込めます。</p>
                    </li>
                    <li>
                        <strong>データのエクスポート:</strong>
                        <p>「出力形式」でCSVまたはJSONを選択し、「ダウンロード」ボタンを押します。</p>
                    </li>
                </ol>
                 <p><small><strong>URLクエリパラメータによる自動操作:</strong> README.mdの「URLクエリパラメータ仕様」を参照してください。</small></p>
            </div>
            <div class="usage-section troubleshooting-guide">
                <h4>困った時は</h4>
                <ul>
                    <li>
                        <strong>URLからの読み込みがうまくいかない場合:</strong>
                        <p>「プロキシサーバー」の選択肢を変更して、再度「URLからHTML読み込み」をお試しください。プロキシサービスや対象サイトの状況により、一時的に読み込めないことがあります。読み込まれたHTMLが期待通りか「HTMLソース」欄で確認してください。それでもうまくいかない場合は、HTMLを手動でコピーして「HTMLソース」欄に貼り付けてください。</p>
                    </li>
                    <li>
                        <strong>抽出結果がおかしい場合:</strong>
                        <p>Pixiv FANBOXのページのHTML構造が変更された可能性があります。「HTMLソース」欄の内容を確認し、期待する情報が含まれているか確認してください。ツール側のセレクタ修正が必要な場合は、開発者にご連絡ください。</p>
                    </li>
                </ul>
            </div>
        </div>

        <div id="urlInputSection">
            <h3>1. FANBOX情報入力</h3>
            <div class="input-group">
                <h4>URLから読み込む</h4>
                <div class="url-fetch-container">
                    <label for="proxySelectEl">プロキシサーバー:</label>
                    <select id="proxySelectEl">
                        </select>
                    <label for="creatorIdInputEl">FanboxクリエイターID:</label>
                    <input type="text" id="creatorIdInputEl" placeholder="例: yourcreatorid">
                    <span class="separator-text">または</span>
                    <label for="fullUrlInputEl">フルURL:</label>
                    <input type="text" id="fullUrlInputEl" placeholder="https://yourcreatorid.fanbox.cc/manage/relationships">
                </div>
                <button id="fetchHtmlBtnEl" class="primary-action">URLからHTML読み込み</button>
                <div class="loader" id="urlLoaderEl"></div>
                <div id="urlStatusEl" class="status-message"></div>
            </div>
        </div>

        <div id="manualInputSection" class="input-group">
             <h4>HTMLソース (URL読み込み結果もここに表示されます)</h4>
            <textarea id="htmlInputEl" placeholder="ここにFanbox支援者一覧ページのHTMLソースを貼り付けるか、上記URLから読み込んでください..."></textarea>
        </div>
        
        <div class="input-group">
            <h3>2. 解析実行</h3>
            <button id="parseHtmlBtnEl" class="primary-action">このHTMLを解析実行</button>
            <div id="parseStatusEl" class="status-message"></div>
        </div>


        <div id="controlsAndPreviewSection" style="display:none;">
            <h3>3. 抽出結果と操作</h3>
            <div class="filter-controls-grid">
                <div class="filter-group">
                    <h4>プランフィルター</h4>
                    <div id="planFilterContainer" class="checkbox-group">
                        </div>
                </div>
                <div class="filter-group">
                    <h4>支援期間フィルター</h4>
                    <div class="duration-filter">
                        <label for="startDateAfterEl">支援開始日 (以降):</label>
                        <input type="date" id="startDateAfterEl">
                    </div>
                    <div class="duration-filter">
                        <label for="startDateBeforeEl">支援開始日 (以前):</label>
                        <input type="date" id="startDateBeforeEl">
                    </div>
                     <div class="duration-filter">
                        <label for="durationMonthsOverEl">継続月数 (以上):</label>
                        <input type="number" id="durationMonthsOverEl" min="0" placeholder="例: 3">
                    </div>
                    <button id="applyFiltersBtnEl">フィルター適用</button>
                    <button id="resetFiltersBtnEl">フィルターリセット</button>
                </div>
            </div>

            <h4>プレビュー (<span id="rowCountEl">0</span> 件)</h4>
            <div class="table-wrapper">
                <table id="previewTableEl">
                    <thead>
                        <tr>
                            <th data-sort="supporter_name">支援者名 <span class="sort-indicator"></span></th>
                            <th data-sort="user_id">ユーザーID <span class="sort-indicator"></span></th>
                            <th data-sort="plan_name">プラン名 <span class="sort-indicator"></span></th>
                            <th data-sort="start_date">支援開始日 <span class="sort-indicator"></span></th>
                            <th data-sort="memo">メモ <span class="sort-indicator"></span></th>
                        </tr>
                    </thead>
                    <tbody id="previewTableBodyEl">
                        </tbody>
                </table>
            </div>

            <div class="export-controls">
                <label for="exportFormatEl">出力形式:</label>
                <select id="exportFormatEl">
                    <option value="csv">CSV</option>
                    <option value="json">JSON</option>
                </select>
                <button id="downloadBtnEl" disabled>ダウンロード</button>
            </div>
        </div>

        <div class="update-history-wrapper">
            <h3 id="updateHistoryToggleBtnEl" class="accordion-toggle">ツールの更新履歴 <span class="accordion-icon">&#9660;</span></h3>
            <div id="updateHistoryContentEl" class="update-history-content accordion-content">
                <ul>
                     <li>
                        <span class="version-date">2025年5月30日</span> <span class="version-rev">(Rev. 1.1)</span>
                        <ul class="change-list">
                            <li>URL読み込み時に取得したHTMLをテキストエリアに表示するよう変更。</li>
                            <li>URL入力/HTML手動入力のUI切り替えを廃止し、常時両方の手段を利用可能に変更。</li>
                        </ul>
                    </li>
                    <li>
                        <span class="version-date">2025年5月30日</span> <span class="version-rev">(Rev. 1)</span>
                        <ul class="change-list">
                            <li>初回リリース。</li>
                            <li>HTMLソースからの支援者名、ユーザーID、プラン名、支援開始日、メモの抽出機能。</li>
                            <li>URLからのHTML読み込み機能（プロキシ経由）。</li>
                            <li>クリエイターIDからのURL自動生成機能。</li>
                            <li>プランフィルター（複数選択可）、支援期間フィルター機能。</li>
                            <li>各列でのソート機能。</li>
                            <li>CSV、JSON形式でのダウンロード機能。</li>
                            <li>URLクエリパラメータによる一部自動操作対応。</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <p class="footer-notice">
            このツールはクライアントサイドで動作します。入力されたURLやHTMLソース、抽出データが外部サーバーに送信されることはありません（プロキシ経由でのHTML取得時を除く）。<br>
            Pixiv FANBOXの利用規約を遵守してご利用ください。HTML構造の変更により、ツールが正常に動作しなくなる場合があります。
        </p>
    </div>
    <script src="script.js" defer></script>
</body>
</html>
